# Sales Protocol  (управляемая проверка качества продажных диалогов)

## Value purpose
Стабильно измерять качество ответов продавца в каждом клиентском диалоге по понятным правилам, выдавать доказуемые кейсы и метрики, чтобы улучшать скрипты/обучение и поднимать retention.

---

## Кому и зачем
**Кому:**
- Sales Ops / руководителям продаж — видеть, что реально происходит в коммуникации.
- QA / контролю качества — уменьшать ручную проверку, оставляя её на спорные кейсы.
- Обучению/тренерам — получать конкретные примеры «как надо / как не надо».
- Продукту/аналитике — иметь стабильные и отказоустойчивые метрики по правилам, а не «мнение модели».

**Зачем:**
- Ручной QA дорогой и не масштабируется.
- «Оценка моделью» без доказательств быстро перестаёт быть доверенной.
- Нужен процесс, который можно повторять и объяснять бизнесу.

---

## Что система делает (по‑простому)
Система проверяет каждый диалог по правилам качества:
- **greeting** — есть ли корректное приветствие в первых 3 сообщениях продавца;
- **upsell** — был ли предложен уместный следующий платный шаг;
- **empathy** — была ли признана ситуация клиента перед решением.

Выход — **таблица (CSV)** с кейсами по правилам (результат, цитата/доказательство, комментарий/рекомендация) + **метрики** по прогону (например, доля срабатываний и корректность проверки).

Пример 


| Диалог | Правило | Результат | Нужна проверка QA | Причина | Комментарий QA | Цитата | Рекомендация |
|---|---|---|---|---|---|---|---|
| modamart__0_transcript | Эмпатия | Получилось | Нет | Эмпатия выражена | Есть явное признание и понимание беспокойств клиента. | I completely understand your concerns. | Подход корректный |
| modamart__1_transcript | Эмпатия | Получилось | Нет | Эмпатия выражена | Продавец признал и ответил на обеспокоенность клиента по поводу свойств утеплителя, что является проявлением эмпатии. | That’s a great point. Down is incredibly warm, but it can lose its insulating properties when wet. Synthetic insulation, on the other hand, retains warmth even when damp. | Подход корректный |
| modamart__0_transcript | Приветствие | Получилось | Нет | Приветствие в нужном окне | Приветствие правильно дано в первом сообщении продавца. | Hi there! Thank you for taking the time to speak with me today. My name is Jamie, and I’m a sales representative from ModaMart. How are you today? | Подход корректный |
| modamart__1_transcript | Приветствие | Получилось | Нет | Приветствие в нужном окне | Приветствие было в первом сообщении продавца, что соответствует требованию приветствия в первых трех сообщениях. | Good morning, this is Sarah from ModaMart. How can I assist you today? | Подход корректный |
| modamart__0_transcript | Допродажа | Получилось | Нет | Есть уместная допродажа | Присутствует предложение скидки как элемент допродажи. | I can also offer you a 10% discount on your first purchase, which might make taking the plunge a bit easier. | Подход корректный |
| modamart__1_transcript | Допродажа | Получилось | Нет | Есть уместная допродажа | В диалоге есть рекомендация экспресс-доставки как платного следующего шага, что соответствует правилу допродажи. | In that case, I’d recommend our express shipping option. | Подход корректный |

---

## Как это работает (контур качества)
1. **Сканирование диалогов**: оценка опирается на полный контекст диалога.
2. **Двойная проверка**: каждый диалог проходит через два слоя оценки (*evaluator* и независимый *judge*).
3. **Аудит и отчётность**: сохраняется полный аудит LLM‑вызовов и привязка результата к конкретному месту в диалоге.



---

## Чем отличается от «Агент/RAG/Файнтюн»? Ценой. 
- **Не “модель решила”**, а правило + доказательство из диалога.
- **Не “покрутили промпт”**, а повторяемый процесс: каждый прогон даёт сопоставимый отчёт.
- **Не “агент делает магию”**, а контролируемая проверка качества с аудитом и понятной точкой изменения правил.

---

## Что уже есть в репозитории (as‑is)
**Цель и ценность:**
- платформа для контроля качества продажных переписок;
- основной эффект — рост retention через стабильное качество ответов в диалогах.

**Правила качества:** greeting / upsell / empathy.

**Надёжность результатов:**
- evaluator + judge на каждый диалог;
- можно считать метрики по правилам;
- сохраняется аудит LLM‑вызовов;
- есть evidence‑anchor на уровне сообщения.

**Точки сборки / запуск:**
- `make setup`, `make init-fresh`, `make scan`, `make report`, `make notebook`.

**Метрики (глоссарий):**
- `evaluator_hit_rate`, `judge_correctness`, `judge_coverage`.

---

# “ТЗ → артефакт” (шаблон) для нового бизнес правила.

| Пункт ТЗ | Этап | Что делаем | Артефакт | Критерий готовности |
|---|---:|---|---|---|
| (пример) Формат входных диалогов | 0 | фиксируем поля/валидацию | data contract | 100% диалогов валидируются |
| (пример) Отчёт по правилам | 1 | метрики + кейсы | report/CSV | читается без ручной чистки |
| (пример) Ручная проверка спорных | 3 | очередь QA + правила эскалации | workflow | спорные кейсы обрабатываются по SLA |
| (пример) Комплаенс/PII | 4 | маскирование + доступы | policy + пайплайн | аудит/доступы соответствуют требованиям |

---